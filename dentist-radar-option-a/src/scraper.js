import got from 'got';import * as cheerio from 'cheerio';const BASE='https://www.nhs.uk';function url(postcode,mi){const km=Math.max(1,Math.round(mi*1.60934));return `${BASE}/service-search/find-a-dentist/results/${encodeURIComponent(postcode)}?distance=${km}`;}export async function fetchHtml(u){const res=await got(u,{headers:{'user-agent':'DentistRadarBot/1.0 (+dentistradar.co.uk)'},http2:true,timeout:{request:15000}});return res.body;}export function parseList(html){const $=cheerio.load(html);const out=[];$('a.nhsuk-card__link, h2 a, h3 a').each((i,el)=>{let name=$(el).text().trim();let href=$(el).attr('href')||'';if(href&&!href.startsWith('http')) href=BASE+href;if(name&&href) out.push({name,url:href});});const m=new Map();out.forEach(x=>m.set(x.url,x));return Array.from(m.values());}export function parseStatus(html){const $=cheerio.load(html);const bits=[];$('p, li, dd').each((i,el)=>{const t=$(el).text().trim();if(/accepting/i.test(t)) bits.push(t);});const status=bits[0]||'';const ok=/accepting\s+new\s+nhs\s+patients/i.test(status)||(/accepting/i.test(status)&&/nhs/i.test(status));return {statusText:status,acceptingFlag:ok?1:0};}export function searchUrl(postcode,mi){return url(postcode,mi);}