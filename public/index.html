<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dentist Radar — Be first to know NHS dentist openings</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- HEADER (unchanged classes for same styling) -->
  <header class="site-header">
    <div class="container navbar">
      <a class="logo" href="/"><img src="logo.svg" alt="Dentist Radar" /></a>
      <button id="menu-toggle" class="menu-toggle" aria-label="Menu">☰</button>
      <ul id="nav-links" class="nav-links">
        <li><a href="pricing.html">Pricing</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="terms.html">Terms</a></li>
        <li><a href="privacy.html">Privacy</a></li>
      </ul>
    </div>
  </header>

  <!-- HERO + FORM (structure preserved) -->
  <main>
    <section class="hero">
      <div class="container hero-inner">
        <h1>Be first to know when NHS dentists open near you</h1>
        <p class="subhead">Enter your details once — we watch the NHS listings and email you fast.</p>

        <form id="alert-form" class="alert-form" novalidate>
          <div class="input">
            <label for="email" class="sr-only">Email</label>
            <input id="email" name="email" type="email" inputmode="email"
                   autocomplete="email" placeholder="Email" required />
          </div>

          <div class="input">
            <label for="postcode" class="sr-only">Postcode</label>
            <input id="postcode" name="postcode" placeholder="Postcode (e.g. RG1 2AB)" required />
          </div>

          <div class="input">
            <label for="radius" class="sr-only">Radius (miles)</label>
            <input id="radius" name="radius" type="number" inputmode="numeric"
                   min="1" max="30" step="1" placeholder="Radius (miles)" required />
          </div>

          <button class="btn primary" type="submit" id="submit-btn">GET MY ALERT</button>
          <p id="form-msg" class="message-box" aria-live="polite"></p>
        </form>

        <p class="fine-print">Free plan supports 1 postcode. Upgrade for more.</p>
      </div>
    </section>

    <!-- HOW IT WORKS (keep your existing content/sections as before) -->
    <section class="how-it-works">
      <div class="container">
        <h2>How it works</h2>
        <ol class="steps">
          <li>Tell us your postcode and radius (up to 30 miles).</li>
          <li>We monitor NHS listings in the background.</li>
          <li>When a practice starts accepting new patients, we email you.</li>
          <li>You call to confirm before travelling.</li>
        </ol>
      </div>
    </section>
  </main>

  <!-- FOOTER (unchanged classes) -->
  <footer class="site-footer">
    <div class="container footer">
      © 2025 Dentist Radar · <a href="privacy.html">Privacy</a> · <a href="terms.html">Terms</a> · <a href="about.html">About</a>
    </div>
  </footer>

  <!-- Minimal JS: POST to YOUR server (no action="" to external sites) -->
  <script>
  (function(){
    const menuBtn = document.getElementById('menu-toggle');
    const nav = document.getElementById('nav-links');
    menuBtn?.addEventListener('click',()=>nav?.classList.toggle('open'));

    const form = document.getElementById('alert-form');
    const msg  = document.getElementById('form-msg');
    const btn  = document.getElementById('submit-btn');

    function show(t, cls){ msg.className = 'message-box show ' + (cls||''); msg.textContent = t; }
    function clearMsg(){ msg.className = 'message-box'; msg.textContent=''; }

    function normalizePostcode(s){
      if(!s) return '';
      const t = String(s).toUpperCase().replace(/[^A-Z0-9]/g,'');
      if(t.length < 5) return String(s).trim();
      return (t.slice(0,t.length-3)+' '+t.slice(-3)).trim();
    }

    form?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      clearMsg();

      const email = document.getElementById('email').value.trim();
      const postcode = normalizePostcode(document.getElementById('postcode').value.trim());
      const radius = Number(document.getElementById('radius').value);

      // quick front-end checks (server does full validation anyway)
      const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email);
      if(!emailOk){ show('Please enter a valid email address.','error'); return; }
      if(!postcode){ show('Please enter a valid UK postcode (e.g. RG1 2AB).','error'); return; }
      if(!radius || radius<1 || radius>30){ show('Please select a radius between 1 and 30 miles.','error'); return; }

      btn.disabled = true; btn.textContent = 'Creating…';
      try{
        const r = await fetch('/api/watch/create', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, postcode, radius })
        });
        const j = await r.json();

        if(j.ok){
          show('✅ Alert created — check your inbox!','success');
          form.reset();
          document.getElementById('radius').value = ''; // leave blank after success
        }else if(j.error === 'duplicate'){
          show('Alert already exists for this postcode.','warn');
        }else if(j.error === 'upgrade_required'){
          show(`Free plan allows ${j.message?.match(/\d+/)?.[0]||'1'} postcode(s). Please upgrade.`,`warn`);
        }else{
          show(j.message || 'Something went wrong. Please try again later.','error');
        }
      }catch(_){
        show('Network error. Please try again.','error');
      }finally{
        btn.disabled=false; btn.textContent='GET MY ALERT';
      }
    });
  })();
  </script>
</body>
</html>
