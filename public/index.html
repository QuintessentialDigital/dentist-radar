<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dentist Radar</title>
  <meta name="description" content="Be first to know when an NHS dentist near you starts accepting new patients. Create postcode alerts in seconds — free plan available."/>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="preload" as="image" href="/logo.svg" imagesizes="(max-width: 480px) 160px, 240px">
  <meta property="og:title" content="Dentist Radar">
  <meta property="og:description" content="Get instant email alerts when nearby NHS dentists start accepting NHS patients.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/favicon.svg">
  <meta name="twitter:card" content="summary">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="navbar">
    <div class="nav-inner">
      <a class="brand" href="/" aria-label="Dentist Radar">
        <img src="/logo.svg" alt="Dentist Radar" width="240" height="44" />
      </a>
      <nav class="nav-links">
        <a href="/pricing.html">Pricing</a>
        <a href="/about.html">About</a>
        <a href="/terms.html">Terms</a>
        <a href="/privacy.html">Privacy</a>
        <a href="/admin.html">Admin</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="card hero">
      <div class="hero-head">
        <h1>Be first to know about NHS dentist openings</h1>
        <p class="lead">
          We monitor public NHS sources and email you the moment a nearby practice starts accepting new NHS patients.
        </p>
        <div class="nhs-note" aria-hidden="false">
          <span class="nhs-dot" aria-hidden="true"></span>
          Data is sourced from publicly available NHS pages. Please double-check with the practice before you travel.
        </div>
      </div>

      <form id="alertForm" class="form-grid" novalidate>
        <div class="f-group">
          <input id="email" name="email" type="email" required inputmode="email" autocomplete="email" placeholder=" " class="f-input" aria-describedby="emailHelp emailErr"/>
          <label for="email" class="f-label">Email</label>
          <div id="emailHelp" class="help">We’ll send alerts here.</div>
          <div id="emailErr" class="field-err" role="alert" aria-live="polite"></div>
        </div>

        <div class="f-group">
          <input id="postcode" name="postcode" type="text" required inputmode="text" placeholder=" " class="f-input f-uppercase" aria-describedby="pcHelp pcErr"/>
          <label for="postcode" class="f-label">Postcode(s)</label>
          <div id="pcHelp" class="help">Free plan allows up to <strong>2 postcodes</strong> per email. Separate with commas (e.g., <code>RG41, RG1</code>).</div>
          <div id="pcErr" class="field-err" role="alert" aria-live="polite"></div>
        </div>

        <div class="f-group">
          <input id="radius" name="radius" type="number" required inputmode="numeric" min="1" max="30" step="1" value="10" placeholder=" " class="f-input" aria-describedby="rHelp rErr"/>
          <label for="radius" class="f-label">Radius (miles)</label>
          <div id="rHelp" class="help">We’ll check practices within this distance (1–30 miles).</div>
          <div id="rErr" class="field-err" role="alert" aria-live="polite"></div>
        </div>

        <button id="createBtn" class="btn" type="submit">
          <span class="btn-label">Get my alert</span>
          <span class="spinner" aria-hidden="true"></span>
        </button>

        <div id="err" class="banner error" hidden></div>
        <div id="info" class="banner info" hidden></div>
      </form>
    </section>

    <section class="card section-gap">
      <h2>How it works</h2>
      <div class="how">
        <div class="step"><strong>1.</strong> Tell us your areas (postcodes)</div>
        <div class="step"><strong>2.</strong> We watch automatically (faster on Pro)</div>
        <div class="step"><strong>3.</strong> You get an email when there’s availability</div>
      </div>
    </section>

    <section class="card section-gap">
      <h2>Why people use Dentist Radar</h2>
      <ul class="trust-list">
        <li><strong>Made in the UK.</strong> Built for NHS patients.</li>
        <li><strong>Privacy first.</strong> We only store what’s needed for alerts.</li>
        <li><strong>Transparent.</strong> We monitor public NHS pages; you confirm directly with the practice.</li>
      </ul>
    </section>
  </main>

  <div class="sticky-cta">
    <button id="createBtnMobile" class="btn btn-full" type="button">
      <span class="btn-label">Get my alert</span>
      <span class="spinner" aria-hidden="true"></span>
    </button>
  </div>

  <footer class="site-footer">
    <div class="footer-inner">
      <div>© 2025 Dentist Radar</div>
      <nav class="footer-links">
        <a href="/pricing.html">Pricing</a>
        <a href="/about.html">About</a>
        <a href="/terms.html">Terms</a>
        <a href="/privacy.html">Privacy</a>
      </nav>
    </div>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <script>
  (function(){
    const $ = id => document.getElementById(id);

    const form   = $('alertForm');
    const btn    = $('createBtn');
    const btnM   = $('createBtnMobile');
    const toast  = $('toast');
    const errBox = $('err'), infoBox = $('info');

    const email  = $('email');
    const pc     = $('postcode');
    const radius = $('radius');

    const emailErr = $('emailErr');
    const pcErr    = $('pcErr');
    const rErr     = $('rErr');

    const btnLabel = btn.querySelector('.btn-label');
    const spinner  = btn.querySelector('.spinner');
    const btnMLabel= btnM.querySelector('.btn-label');
    const spinnerM = btnM.querySelector('.spinner');

    const emailRe = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
    const fullUK  = /^[A-Z]{1,2}\\d[A-Z\\d]?\\s*\\d[A-Z]{2}$/;
    const outward = /^[A-Z]{1,2}\\d[A-Z\\d]?$/;

    function validPostcodeToken(tok){
      const t = tok.replace(/\\s+/g,'').toUpperCase();
      return fullUK.test(t) || outward.test(t);
    }

    function fieldError(inputEl, errEl, msg){ inputEl.setAttribute('aria-invalid','true'); errEl.textContent = msg || ''; }
    function fieldOK(inputEl, errEl){ inputEl.removeAttribute('aria-invalid'); errEl.textContent = ''; }

    function validateAll(){
      let bad = false;

      const e = email.value.trim();
      if (!e || !emailRe.test(e)){ fieldError(email, emailErr, 'Please enter a valid email.'); bad = true; }
      else fieldOK(email, emailErr);

      const r = Number(radius.value.trim());
      if (!Number.isInteger(r) || r < 1 || r > 30){ fieldError(radius, rErr, 'Radius must be 1–30 miles.'); bad = true; }
      else fieldOK(radius, rErr);

      const tokens = pc.value.split(',').map(s=>s.trim()).filter(Boolean);
      if (!tokens.length){ fieldError(pc, pcErr, 'Enter at least one postcode.'); bad = true; }
      else {
        for (const t of tokens){
          if (!validPostcodeToken(t)){ fieldError(pc, pcErr, 'Invalid postcode: "'+t+'". Use full (RG41 3XX) or outward (RG41).'); bad = true; break; }
        }
        if (!bad) fieldOK(pc, pcErr);
      }
      return !bad;
    }

    pc.addEventListener('input', e=>{
      const v = e.target.value.toUpperCase().replace(/\\s+/g,' ').replace(/,\\s*/g, ', ');
      e.target.value = v;
    });

    function showToast(message, type='success'){
      toast.textContent = message;
      toast.className = 'toast ' + (type==='success' ? 'toast-success' : 'toast-error');
      requestAnimationFrame(()=> toast.classList.add('show'));
      setTimeout(()=> toast.classList.remove('show'), 3200);
    }

    function setLoading(on){
      if (on){
        btn.disabled = true; btnM.disabled = true;
        btnLabel.textContent = 'Creating…'; btnMLabel.textContent = 'Creating…';
        spinner.style.display = 'inline-block'; spinnerM.style.display = 'inline-block';
      } else {
        btn.disabled = false; btnM.disabled = false;
        btnLabel.textContent = 'Get my alert'; btnMLabel.textContent = 'Get my alert';
        spinner.style.display = 'none'; spinnerM.style.display = 'none';
      }
    }

    function hideGlobal(){ errBox.hidden = true; errBox.textContent = ''; infoBox.hidden = true; infoBox.textContent = ''; }
    function showGlobal(el, msg){ el.hidden=false; el.textContent=msg; }

    async function submitForm(){
      hideGlobal();
      if (!validateAll()) return;

      try{
        setLoading(true);
        const res = await fetch('/api/watch', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email: email.value.trim(), postcode: pc.value.trim(), radius: Number(radius.value.trim()) })
        });
        const j = await res.json().catch(()=>null);

        if (res.ok && j && j.ok){
          if (j.duplicates > 0) showGlobal(infoBox, \`Note: \${j.duplicates} duplicate \${j.duplicates===1?'postcode was':'postcodes were'} skipped.\`);
          showToast('🎉 You’re all set! We’ll email you when a dentist near you opens NHS spots.');
          form.reset();
          [email, pc, radius].forEach(i=>i.removeAttribute('aria-invalid'));
          [emailErr, pcErr, rErr].forEach(e=>e.textContent='');
        } else {
          if (j && j.code === 'free_limit'){
            showGlobal(errBox, j.error + ' Want to track more areas? Upgrade to Pro for unlimited postcodes.');
          } else {
            showGlobal(errBox, (j && j.error) ? ('❌ ' + j.error) : '❌ Could not create alert.');
          }
        }
      } catch(ex){
        showGlobal(errBox, 'Network error: ' + (ex && ex.message ? ex.message : 'unknown'));
      } finally {
        setLoading(false);
      }
    }

    form.addEventListener('submit', e=>{ e.preventDefault(); submitForm(); });
    $('createBtnMobile').addEventListener('click', submitForm);
  })();
  </script>
</body>
</html>
