<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dentist Radar</title>
  <meta name="description" content="Be first to know when an NHS dentist near you starts accepting new patients. Create postcode alerts in seconds â€” free plan available.">
  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <!-- NAVBAR -->
  <header class="navbar">
    <div class="nav-inner">
      <a class="brand" href="/" aria-label="Dentist Radar">
        <img src="/logo.svg" alt="Dentist Radar" width="340" height="68" />
      </a>

      <!-- Mobile toggle -->
      <button class="nav-toggle" aria-label="Open menu" aria-expanded="false">
        <span class="nav-burger"></span>
      </button>

      <nav class="nav-links" aria-label="Primary">
        <a href="/pricing.html">Pricing</a>
        <a href="/about.html">About</a>
        <a href="/terms.html">Terms</a>
        <a href="/privacy.html">Privacy</a>
        <a href="/admin.html">Admin</a>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="wrap">
    <!-- HERO + FORM -->
    <section class="card hero">
      <div class="hero-head">
        <h1>Be first to know about NHS dentist openings</h1>
        <p class="lead">We monitor public NHS sources and email you the moment a nearby practice starts accepting new NHS patients.</p>
        <div class="nhs-note">
          <span class="nhs-dot" aria-hidden="true"></span>
          Data is sourced from publicly available NHS pages. Please confirm directly with the practice before you travel.
        </div>
      </div>

      <form id="alertForm" class="form-grid" novalidate>
        <div class="f-group">
          <input id="email" name="email" type="email" autocomplete="email"
                 class="f-input" placeholder=" " required aria-describedby="emailHelp emailErr">
          <label for="email" class="f-label">Email</label>
          <div id="emailHelp" class="help">Weâ€™ll send alerts here.</div>
          <div id="emailErr" class="field-err" role="alert" aria-live="polite"></div>
        </div>

        <div class="f-group">
          <input id="postcode" name="postcode" type="text"
                 class="f-input f-uppercase" placeholder=" " required aria-describedby="pcHelp pcErr">
          <label for="postcode" class="f-label">Postcode(s)</label>
          <div id="pcHelp" class="help">
            <strong>Free plan supports 1 postcode.</strong> (e.g., <code>RG41</code> or <code>RG41 3XX</code>)
          </div>
          <div id="pcErr" class="field-err" role="alert" aria-live="polite"></div>
        </div>

        <div class="f-group">
          <input id="radius" name="radius" type="number" min="1" max="30" step="1" value="10"
                 class="f-input" placeholder=" " required aria-describedby="rHelp rErr">
          <label for="radius" class="f-label">Radius (miles)</label>
          <div id="rHelp" class="help">Weâ€™ll check practices within this distance (1â€“30 miles).</div>
          <div id="rErr" class="field-err" role="alert" aria-live="polite"></div>
        </div>

        <button id="createBtn" class="btn" type="submit">
          <span class="btn-label">Get my alert</span>
          <span class="spinner" aria-hidden="true"></span>
        </button>

        <div id="err" class="banner error" hidden></div>
        <div id="info" class="banner info" hidden></div>
      </form>
    </section>

    <!-- HOW IT WORKS -->
    <section class="card section-gap">
      <h2>How it works</h2>
      <div class="how">
        <div class="step"><strong>1.</strong> Enter your area</div>
        <div class="step"><strong>2.</strong> We watch automatically</div>
        <div class="step"><strong>3.</strong> We email you when thereâ€™s availability</div>
      </div>
    </section>

    <!-- WHY TRUST US -->
    <section class="card trust">
      <h2>Why thousands trust Dentist Radar</h2>
      <ul class="trust-points">
        <li>
          <img src="/icons/shield.svg" alt="" class="trust-icon" />
          <div>
            <h3>Verified NHS Data</h3>
            <p>We monitor <strong>official NHS Find a Dentist pages</strong> every hour to give you accurate, up-to-date information â€” straight from the source.</p>
          </div>
        </li>
        <li>
          <img src="/icons/lock.svg" alt="" class="trust-icon" />
          <div>
            <h3>GDPR & Privacy Compliant</h3>
            <p>Your data is protected. We use encrypted storage and send alerts via <strong>Postmark</strong>, a UK-compliant, secure email service.</p>
          </div>
        </li>
        <li>
          <img src="/icons/timer.svg" alt="" class="trust-icon" />
          <div>
            <h3>Always Up to Date</h3>
            <p>Our system scans NHS data automatically â€” <strong>every 60 minutes on free plans</strong> and up to every 15 minutes for Pro users.</p>
          </div>
        </li>
        <li>
          <img src="/icons/heart.svg" alt="" class="trust-icon" />
          <div>
            <h3>No Spam. Ever.</h3>
            <p>We only send alerts youâ€™ve requested. You can unsubscribe with a single click. No marketing emails. No hidden fees.</p>
          </div>
        </li>
        <li>
          <img src="/icons/building.svg" alt="" class="trust-icon" />
          <div>
            <h3>Built in the UK</h3>
            <p>Created and hosted in the United Kingdom to help families find real NHS dental care faster â€” built by parents, for parents.</p>
          </div>
        </li>
      </ul>

      <div class="trust-footer">
        <p><strong>Last data scan:</strong> <span id="scanTime">Checking...</span></p>
        <p><em>Data sourced from official NHS.uk listings</em></p>
      </div>
    </section>
  </main>

  <!-- MOBILE STICKY CTA -->
  <div class="sticky-cta">
    <button id="createBtnMobile" class="btn btn-full" type="button">
      <span class="btn-label">Get my alert</span>
      <span class="spinner" aria-hidden="true"></span>
    </button>
  </div>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="footer-inner">
      <div>Â© 2025 Dentist Radar</div>
      <nav class="footer-links">
        <a href="/pricing.html">Pricing</a>
        <a href="/about.html">About</a>
        <a href="/terms.html">Terms</a>
        <a href="/privacy.html">Privacy</a>
      </nav>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script>
  // Mobile menu toggle
  (function(){
    const toggle = document.querySelector('.nav-toggle');
    const links  = document.querySelector('.nav-links');
    if (toggle && links){
      toggle.addEventListener('click', ()=>{
        const open = links.classList.toggle('open');
        toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    }
  })();
  </script>

  <script>
  // Form logic (validation + submit)
  (function(){
    const $ = id => document.getElementById(id);

    const form   = $('alertForm');
    const btn    = $('createBtn');
    const btnM   = $('createBtnMobile');
    const toast  = $('toast');
    const errBox = $('err'), infoBox = $('info');

    const email  = $('email');
    const pc     = $('postcode');
    const radius = $('radius');

    const emailErr = $('emailErr');
    const pcErr    = $('pcErr');
    const rErr     = $('rErr');

    const btnLabel = btn.querySelector('.btn-label');
    const spinner  = btn.querySelector('.spinner');
    const btnMLabel= btnM.querySelector('.btn-label');
    const spinnerM = btnM.querySelector('.spinner');

    const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const fullUK  = /^[A-Z]{1,2}\d[A-Z\d]?\s*\d[A-Z]{2}$/;
    const outward = /^[A-Z]{1,2}\d[A-Z\d]?$/;

    function validPostcodeToken(tok){
      const t = tok.replace(/\s+/g,'').toUpperCase();
      return fullUK.test(t) || outward.test(t);
    }

    function fieldError(inputEl, errEl, msg){ inputEl.setAttribute('aria-invalid','true'); errEl.textContent = msg || ''; }
    function fieldOK(inputEl, errEl){ inputEl.removeAttribute('aria-invalid'); errEl.textContent = ''; }

    function hideGlobal(){ errBox.hidden = true; errBox.textContent = ''; infoBox.hidden = true; infoBox.textContent = ''; }
    function showGlobal(el, msg){ el.hidden=false; el.innerHTML = msg; }

    function setLoading(on){
      if (on){
        btn.disabled = true; btnM.disabled = true;
        btnLabel.textContent = 'Creatingâ€¦'; btnMLabel.textContent = 'Creatingâ€¦';
        spinner.style.display = 'inline-block'; spinnerM.style.display = 'inline-block';
      } else {
        btn.disabled = false; btnM.disabled = false;
        btnLabel.textContent = 'Get my alert'; btnMLabel.textContent = 'Get my alert';
        spinner.style.display = 'none'; spinnerM.style.display = 'none';
      }
    }

    pc.addEventListener('input', e=>{
      const v = e.target.value.toUpperCase().replace(/\s+/g,' ').replace(/,\s*/g, ', ');
      e.target.value = v;
    });

    function validateAll(){
      let bad = false;

      const e = email.value.trim();
      if (!e || !emailRe.test(e)){ fieldError(email, emailErr, 'Please enter a valid email.'); bad = true; }
      else fieldOK(email, emailErr);

      const r = Number(radius.value.trim());
      if (!Number.isInteger(r) || r < 1 || r > 30){ fieldError(radius, rErr, 'Radius must be 1â€“30 miles.'); bad = true; }
      else fieldOK(radius, rErr);

      const tokens = pc.value.split(',').map(s=>s.trim()).filter(Boolean);
      if (!tokens.length){ fieldError(pc, pcErr, 'Enter a postcode.'); bad = true; }
      else if (tokens.length > 1){
        fieldError(pc, pcErr, 'Free plan supports 1 postcode.');
        showGlobal(errBox, 'Free plan supports 1 postcode. <a href="/pricing.html" style="text-decoration:underline;color:#0b3b6b;">Upgrade to add more areas</a>.');
        bad = true;
      } else {
        const t = tokens[0];
        if (!validPostcodeToken(t)){ fieldError(pc, pcErr, 'Invalid postcode. Use full (RG41 3XX) or outward (RG41).'); bad = true; }
        else fieldOK(pc, pcErr);
      }
      return !bad;
    }

    async function submitForm(){
      hideGlobal();
      if (!validateAll()) return;

      try{
        setLoading(true);
        const res = await fetch('/api/watch', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({
            email: email.value.trim(),
            postcode: pc.value.trim(),
            radius: Number(radius.value.trim())
          })
        });
        const j = await res.json().catch(()=>null);

        if (res.ok && j && j.ok){
          if (j.duplicates > 0){
            showGlobal(infoBox, 'Note: duplicate alert skipped for this email/postcode.');
          } else {
            infoBox.hidden = true;
          }
          showGlobal(errBox, ''); // clear error if any
          showGlobal(infoBox, 'ðŸŽ‰ Alert set. Weâ€™ll email you as soon as thereâ€™s a match.');
          form.reset();
          [email, pc, radius].forEach(i=>i.removeAttribute('aria-invalid'));
          [emailErr, pcErr, rErr].forEach(e=>e.textContent='');
        } else {
          if (j && j.code === 'free_limit'){
            showGlobal(errBox, 'Free plan supports 1 postcode. <a href="/pricing.html" style="text-decoration:underline;color:#0b3b6b;">Upgrade to add more areas</a>.');
          } else {
            showGlobal(errBox, (j && j.error) ? ('âŒ ' + j.error) : 'âŒ Could not create alert.');
          }
        }
      } catch(ex){
        showGlobal(errBox, 'Network error: ' + (ex && ex.message ? ex.message : 'unknown'));
      } finally {
        setLoading(false);
      }
    }

    form.addEventListener('submit', e=>{ e.preventDefault(); submitForm(); });
    document.getElementById('createBtnMobile').addEventListener('click', submitForm);
  })();
  </script>

  <!-- TRUST: last scan time -->
  <script>
  (async()=>{
    try{
      const res = await fetch('/health');
      const j = await res.json().catch(()=>null);
      const el = document.getElementById('scanTime');
      if(el){
        if(j && j.ok && j.time){
          el.textContent = new Date(j.time).toLocaleString('en-GB',{dateStyle:'medium',timeStyle:'short'});
        } else {
          el.textContent = 'Unavailable';
        }
      }
    }catch{
      const el = document.getElementById('scanTime');
      if (el) el.textContent = 'Unavailable';
    }
  })();
  </script>

  <!-- Toast container (if you want toast feedback later) -->
  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
</body>
</html>
