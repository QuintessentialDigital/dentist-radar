<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dentist Radar</title>
  <meta name="description" content="Be first to know when an NHS dentist near you starts accepting new patients. Create postcode alerts in seconds — free plan available."/>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="navbar">
    <div class="nav-inner">
      <a class="brand" href="/">
        <img src="/logo.svg" alt="Dentist Radar logo" width="180" height="36"/>
        <span class="sr-only">Dentist Radar</span>
      </a>
      <nav class="nav-links">
        <a href="/about.html">About</a>
        <a href="/terms.html">Terms</a>
        <a href="/privacy.html">Privacy</a>
        <a href="/admin.html">Admin</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- HERO -->
    <section class="card hero">
      <div class="hero-copy">
        <h1>Be first to know about NHS dentist openings</h1>
        <p class="lead">
          We watch public NHS sources and email you the moment a nearby practice appears to accept new NHS patients.
        </p>

        <form id="alertForm" class="form-grid" novalidate>
          <!-- Email -->
          <div class="f-group">
            <input id="email" name="email" type="email" required
                   inputmode="email" autocomplete="email" placeholder=" "
                   aria-describedby="emailHelp" class="f-input"/>
            <label for="email" class="f-label">Email</label>
            <div id="emailHelp" class="help">We’ll send alerts here.</div>
          </div>

          <!-- Postcodes -->
          <div class="f-group">
            <input id="postcode" name="postcode" type="text" required
                   inputmode="text" placeholder=" "
                   aria-describedby="pcHelp" class="f-input f-uppercase"/>
            <label for="postcode" class="f-label">Postcode(s)</label>
            <div id="pcHelp" class="help">
              Multiple allowed — separate with commas (e.g., <code>RG41, RG1</code>). Accepts full postcodes or outward codes.
            </div>
          </div>

          <!-- Radius -->
          <div class="f-group">
            <input id="radius" name="radius" type="number" required
                   inputmode="numeric" min="1" max="30" step="1" value="10"
                   placeholder=" " class="f-input"/>
            <label for="radius" class="f-label">Radius (miles)</label>
            <div class="help">1–30 miles.</div>
          </div>

          <button id="createBtn" class="btn" type="submit">
            <span class="btn-label">Create alert</span>
            <span class="spinner" aria-hidden="true"></span>
          </button>

          <div id="err" class="banner error" hidden></div>
        </form>
      </div>

      <!-- Illustration (inline SVG so no external file needed) -->
      <figure class="hero-figure" aria-hidden="true">
        <svg viewBox="0 0 420 320" class="hero-svg" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#0EA5E9"/>
              <stop offset="1" stop-color="#10B981"/>
            </linearGradient>
          </defs>
          <rect x="0" y="0" width="420" height="320" rx="24" fill="#f2f6fb"/>
          <!-- radar rings -->
          <circle cx="210" cy="160" r="110" fill="none" stroke="#cfe3f5" stroke-width="2"/>
          <circle cx="210" cy="160" r="75" fill="none" stroke="#cfe3f5" stroke-width="2"/>
          <circle cx="210" cy="160" r="40" fill="none" stroke="#cfe3f5" stroke-width="2"/>
          <!-- tooth pin -->
          <g transform="translate(190,120)">
            <path d="M20 0c10 0 18 8 18 18 0 16-8 30-18 30s-18-14-18-30C2 8 10 0 20 0z" fill="url(#g1)"/>
            <circle cx="20" cy="18" r="7" fill="#fff"/>
          </g>
          <!-- check badge -->
          <g transform="translate(300,40)">
            <rect width="80" height="30" rx="12" fill="url(#g1)"/>
            <path d="M18 16l6 6 12-12" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
          </g>
        </svg>
      </figure>
    </section>

    <!-- HOW IT WORKS -->
    <section class="card">
      <h2>How it works</h2>
      <div class="how">
        <div class="step">
          <div class="ico">1</div>
          <div>Tell us your areas (postcodes)</div>
        </div>
        <div class="step">
          <div class="ico">2</div>
          <div>We watch automatically (faster on Pro)</div>
        </div>
        <div class="step">
          <div class="ico">3</div>
          <div>You get an email when there’s availability</div>
        </div>
      </div>
    </section>

    <!-- TRUST STRIP -->
    <section class="card trust">
      <h2>Why people use Dentist Radar</h2>
      <ul class="trust-list">
        <li><strong>Made in the UK.</strong> Built for NHS patients.</li>
        <li><strong>Privacy first.</strong> We only store what’s needed for alerts. Unsubscribe anytime.</li>
        <li><strong>Transparent.</strong> We monitor public sources and ask you to confirm with the practice before travel.</li>
      </ul>
    </section>

    <!-- OPTIONAL REAL PHOTO (add later if you want) -->
    <!--
    <section class="card">
      <picture>
        <source srcset="/photos/clinic-960.jpg" media="(min-width: 720px)">
        <img src="/photos/clinic-480.jpg" class="hero-photo" alt="Patient speaking with a dental receptionist" loading="lazy">
      </picture>
      <p class="photo-caption">Add a genuine photo from your clinic or a royalty-free image you have rights to use.</p>
    </section>
    -->
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      <div>© 2025 Dentist Radar</div>
      <nav class="footer-links">
        <a href="/about.html">About</a>
        <a href="/terms.html">Terms</a>
        <a href="/privacy.html">Privacy</a>
      </nav>
    </div>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <script>
  (function(){
    const $ = id => document.getElementById(id);
    const err = $('err'), btn = $('createBtn'), form = $('alertForm'), toastEl = $('toast');
    const btnLabel = btn.querySelector('.btn-label');
    const spinner  = btn.querySelector('.spinner');

    const emailRe = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
    const fullUK  = /^[A-Z]{1,2}\\d[A-Z\\d]?\\s*\\d[A-Z]{2}$/;
    const outward = /^[A-Z]{1,2}\\d[A-Z\\d]?$/;

    function validPostcodeToken(tok){
      const t = tok.replace(/\\s+/g,'').toUpperCase();
      return fullUK.test(t) || outward.test(t);
    }

    function validate(email, postcode, radius){
      if (!email || !emailRe.test(email)) return 'Please enter a valid email.';
      const r = Number(radius);
      if (!Number.isInteger(r) || r < 1 || r > 30) return 'Radius must be a whole number between 1 and 30.';
      const tokens = postcode.split(',').map(s=>s.trim()).filter(Boolean);
      if (!tokens.length) return 'Enter at least one postcode.';
      for (const t of tokens){
        if (!validPostcodeToken(t)) return 'Invalid postcode: "'+t+'". Use full postcode (e.g., RG41 3XX) or outward (e.g., RG41).';
      }
      return null;
    }

    function showError(msg){ err.hidden = false; err.textContent = msg; }
    function hideError(){ err.hidden = true; err.textContent = ''; }

    // Auto-uppercase & tidy spaces in postcode as user types
    const pcInput = $('postcode');
    pcInput.addEventListener('input', ()=>{
      const normalized = pcInput.value
        .toUpperCase()
        .split(',')
        .map(s => s.replace(/\\s+/g,' ').trim())
        .join(', ');
      pcInput.value = normalized;
    });

    function showToast(message, type='success'){
      toastEl.textContent = message;
      toastEl.className = 'toast ' + (type==='success' ? 'toast-success' : 'toast-error');
      requestAnimationFrame(()=> toastEl.classList.add('show'));
      setTimeout(()=> toastEl.classList.remove('show'), 3200);
    }

    function setLoading(on){
      if (on){ btn.disabled = true; btnLabel.textContent='Creating…'; spinner.style.display='inline-block'; }
      else   { btn.disabled = false; btnLabel.textContent='Create alert'; spinner.style.display='none'; }
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      hideError();

      const email   = $('email').value.trim();
      const radius  = $('radius').value.trim();
      const postcode= $('postcode').value
        .split(',').map(s=>s.trim().toUpperCase().replace(/\\s+/g,' '))
        .filter(Boolean).join(', ');

      const problem = validate(email, postcode, radius);
      if (problem){ showError(problem); return; }

      try{
        setLoading(true);
        const res = await fetch('/api/watch', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, postcode, radius: Number(radius) })
        });
        const j = await res.json().catch(()=>null);
        if (res.ok && j && j.ok){
          form.reset();
          showToast('✅ Alert created! We’ll email you when a match appears.','success');
        } else {
          showError((j && j.error) ? ('❌ ' + j.error) : '❌ Could not create alert.');
        }
      } catch(ex){
        showError('Network error: ' + (ex && ex.message ? ex.message : 'unknown'));
      } finally {
        setLoading(false);
      }
    });
  })();
  </script>
</body>
</html>
