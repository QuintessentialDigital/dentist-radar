(function(){function byId(i){return document.getElementById(i)}function show(e,m){if(typeof m==='string')e.textContent=m;else e.innerHTML=m;e.style.display='block'}function hide(e){e.style.display='none';e.textContent='';e.innerHTML=''}document.addEventListener('DOMContentLoaded',function(){var f=byId('f');if(f)f.addEventListener('submit',DR_submit)});window.DR_submit=async function(e){if(e&&e.preventDefault)e.preventDefault();var ok=byId('ok'),err=byId('err');[ok,err].forEach(x=>x&&hide(x));var email=byId('email').value.trim(),postcode=byId('postcode').value.trim(),radius=Number(byId('radius').value||10);if(!email||!postcode){show(err,'Please enter email and postcode(s).');return false}try{var r=await fetch(apiPath('/api/watch'),{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({email,postcode,radius_miles:radius})});var txt=await r.text();var j;try{j=JSON.parse(txt)}catch(_){j=null}if(!r.ok){show(err,'HTTP '+r.status+': '+(j?.error||txt||'failed'));return false}if(j&&j.ok){show(ok,'✅ Alert created! '+(j.created?.length||1)+' area(s).');byId('f').reset();return false}show(err,'❌ '+(j?.error||'failed'))}catch(ex){show(err,'Network error: '+ex.message)}return false};window.checkout=async function(plan){var email=prompt('Enter your email to continue:');if(!email)return false;try{var r=await fetch(apiPath('/api/checkout/session'),{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({email,plan})});var j=await r.json();if(j.ok&&j.url){window.location=j.url}else{alert('Could not start checkout: '+(j.error||'failed'))}}catch(e){alert('Network error: '+e.message)}return false}})();