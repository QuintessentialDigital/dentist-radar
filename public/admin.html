<!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><title>Admin ‚Äî Dentist Radar</title><link rel='stylesheet' href='/assets/normalize.css'><link rel='stylesheet' href='/assets/theme.css'><link rel='icon' href='/assets/favicon.svg'></head><body><div class='wrap'><script src='/assets/config.js'></script><h1>üõ† Admin</h1><div id='msg' class='note'>Create a test watch, list watches, and run scans.</div><div class='card'><label>Email</label><input id='email' placeholder='you@gmail.com'><label>Postcodes (comma separated)</label><input id='postcode' placeholder='RG41, RG1, SL6'><label>Radius</label><input id='radius' type='number' value='10' min='1' max='30'><div style='margin-top:12px'><button class='btn' id='createBtn'>Create test watch</button> <button class='btn' id='refreshBtn'>Refresh list</button></div></div><div id='list'></div></div><script>function setMsg(t,ok=true){var el=document.getElementById('msg');el.style.color=ok?'#065F46':'#7F1D1D';el.textContent=t;} async function createTest(){var email=document.getElementById('email').value.trim();var postcode=document.getElementById('postcode').value.trim();var radius=Number(document.getElementById('radius').value||10); if(!email||!postcode){setMsg('Please enter both email and postcode(s).',false);return;} try{const res=await fetch(apiPath('/api/watch'),{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({email,postcode,radius_miles:radius})}); const txt=await res.text(); let j; try{ j=JSON.parse(txt);}catch(e){ j=null;} if(!res.ok){ setMsg('HTTP '+res.status+': '+(j&&j.error || txt || 'failed'),false); return;} if(j&&j.ok){ setMsg('‚úÖ Created '+((j.created&&j.created.length)||1)+' area(s).',true); load(); } else { setMsg('‚ùå Error: '+(j&&j.error || 'failed'),false);} }catch(e){ setMsg('‚ùå Network error: '+e.message,false);} } async function load(){ try{const pass=prompt('Admin password (set ADMIN_PASSWORD env):',''); if(pass===null){ setMsg('Load canceled.',false); return;} const res=await fetch(apiPath('/api/admin/watches'),{ headers:{ Authorization:'Basic '+btoa('admin:'+pass) }}); if(!res.ok){ setMsg('Auth failed or server error ('+res.status+'). Check ADMIN_PASSWORD.',false); return;} const j=await res.json(); const root=document.getElementById('list'); root.innerHTML=''; if(!j.items||j.items.length===0){ root.innerHTML='<div class="card">No watches yet.</div>'; return;} j.items.forEach(w=>{ const d=document.createElement('div'); d.className='card'; d.innerHTML=`<strong>#${w.id}</strong> ¬∑ ${w.postcode} ¬∑ ${w.radius_miles} miles ¬∑ every ${w.frequency_minutes} min ¬∑ email: ${w.contact_email||''} <div style='margin-top:6px'><button class='btn' data-id='${w.id}'>Run now</button></div>`; d.querySelector('button').onclick=()=>runScan(w.id,d.querySelector('button')); root.appendChild(d); }); setMsg('‚úÖ Loaded '+j.items.length+' watch(es).',true); }catch(e){ setMsg('‚ùå Could not load watches: '+e.message,false);} } async function runScan(id,btn){const old=btn.textContent; btn.disabled=true; btn.textContent='Running‚Ä¶'; try{ const res=await fetch(apiPath('/api/watch/'+id+'/run'),{method:'POST'}); const j=await res.json(); if(j.ok){ setMsg('‚úÖ Scan complete. Alerts sent: '+(j.result&&j.result.alerts||0),true);} else { setMsg('‚ùå Scan failed: '+(j.error||'failed'),false);} }catch(e){ setMsg('‚ùå Scan error: '+e.message,false);} btn.disabled=false; btn.textContent=old; } document.getElementById('createBtn').addEventListener('click',createTest); document.getElementById('refreshBtn').addEventListener('click',load);</script></body></html>