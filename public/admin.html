<!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><title>Admin</title><link rel='stylesheet' href='/assets/theme.css'></head><body><h1>Admin</h1><p id='msg'></p><div><input id='email' placeholder='email'><input id='postcode' placeholder='RG41, RG1'><input id='radius' type='number' value='10'><button id='createBtn'>Create test watch</button></div><div><button id='refreshBtn'>Refresh list</button></div><div><input id='testTo' placeholder='test@domain.com'><button id='sendTestBtn'>Send test email</button></div><div><input id='availPractice' placeholder='Practice'><input id='availPostcode' placeholder='RG41'><input id='availLink' placeholder='Link'><button id='simulateBtn'>Simulate availability</button></div><div id='list'></div><script>function setMsg(t,ok=true){var el=document.getElementById('msg');el.style.color=ok?'green':'red';el.textContent=t;}async function createTest(){var email=document.getElementById('email').value.trim();var postcode=document.getElementById('postcode').value.trim();var radius=Number(document.getElementById('radius').value||10);if(!email||!postcode){setMsg('Enter email and postcode(s).',false);return;}var res=await fetch('/api/watch',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({email,postcode,radius_miles:radius})});var j=await res.json();if(j.ok){setMsg('Created '+(j.created?.length||1)+' area(s).',true);load();}else setMsg('Error: '+j.error,false);}async function load(){var pass=prompt('Admin password:','');if(pass===null){return;}var res=await fetch('/api/admin/watches',{headers:{Authorization:'Basic '+btoa('admin:'+pass)}});if(!res.ok){setMsg('Auth failed '+res.status,false);return;}var j=await res.json();var root=document.getElementById('list');root.innerHTML='';(j.items||[]).forEach(function(w){var d=document.createElement('div');d.innerHTML='#'+w.id+' · '+w.postcode+' · '+w.email;root.appendChild(d);});setMsg('Loaded '+(j.items||[]).length+' watch(es).',true);}async function sendTestEmail(){var to=document.getElementById('testTo').value.trim();var pass=prompt('Admin password:','');var r=await fetch('/api/admin/test-email',{method:'POST',headers:{'content-type':'application/json',Authorization:'Basic '+btoa('admin:'+pass)},body:JSON.stringify({to})});setMsg(r.ok?'Test sent.':'Failed '+r.status,r.ok);}async function simulateAvailability(){var practice=document.getElementById('availPractice').value.trim();var postcode=document.getElementById('availPostcode').value.trim();var link=document.getElementById('availLink').value.trim();var pass=prompt('Admin password:','');var r=await fetch('/api/admin/availability',{method:'POST',headers:{'content-type':'application/json',Authorization:'Basic '+btoa('admin:'+pass)},body:JSON.stringify({practice,postcode,link})});var j=await r.json();setMsg(r.ok&&j.ok?'Matched '+j.matched+', sent '+j.sent:'Failed '+(j.error||r.status),r.ok&&j.ok);}document.getElementById('createBtn').onclick=createTest;document.getElementById('refreshBtn').onclick=load;document.getElementById('sendTestBtn').onclick=sendTestEmail;document.getElementById('simulateBtn').onclick=simulateAvailability;</script></body></html>