<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin — Dentist Radar</title>
  <link rel="icon" href="/favicon.svg"/><link rel="stylesheet" href="/style.css"/>
  <style>
    .admin-wrap{max-width:960px;margin:24px auto;padding:16px}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    input,button{height:44px;padding:0 12px;border:1px solid #dcdcdc;border-radius:8px}
    button{border:2px solid #0b63ff;background:#0b63ff;color:#fff;font-weight:700;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:12px;background:#fff;border:1px solid #eee}
    th,td{padding:8px 10px;border-bottom:1px solid #f1f1f1;text-align:left}
    th{background:#f8f9ff}
    .msg{margin:8px 0;font-weight:600}
  </style>
</head>
<body>
<header>
  <div class="container navbar">
    <a href="/" class="logo"><img src="/logo.svg" alt="Dentist Radar"/></a>
    <button class="menu-toggle" id="menu-toggle">☰</button>
    <ul class="nav-links" id="nav-links">
      <li><a href="/">Home</a></li>
      <li><a href="/pricing.html">Pricing</a></li>
      <li><a href="/about.html">About</a></li>
      <li><a href="/terms.html">Terms</a></li>
      <li><a href="/privacy.html">Privacy</a></li>
    </ul>
  </div>
</header>

<main class="admin-wrap">
  <h1>Admin</h1>
  <div class="row">
    <input id="apw" type="password" placeholder="Admin password">
    <button id="btnList">List latest 200</button>
    <input id="testTo" type="email" placeholder="Test email to">
    <button id="btnTest">Send test email</button>
  </div>
  <div id="amsg" class="msg"></div>
  <div style="overflow:auto">
    <table id="tbl"><thead><tr><th>Created</th><th>Email</th><th>Postcode</th><th>Radius</th></tr></thead><tbody></tbody></table>
  </div>
</main>

<footer><div class="container">
  <p>© 2025 Dentist Radar · <a href="/about.html">About</a> · <a href="/privacy.html">Privacy</a> · <a href="/terms.html">Terms</a></p>
</div></footer>

<script>
  document.getElementById('menu-toggle')?.addEventListener('click',()=>document.getElementById('nav-links')?.classList.toggle('open'));
  const msg=document.getElementById('amsg'); const show=(m,ok=true)=>{msg.textContent=m;msg.style.color=ok?'#222':'#c00';};
  document.getElementById('btnList')?.addEventListener('click',async()=>{
    show('Loading…');
    const password=document.getElementById('apw').value||'';
    try{
      const res=await fetch('/api/admin/list',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password})});
      const j=await res.json().catch(()=>null);
      if(!res.ok||!j?.ok){show(j?.error||'Failed',false);return;}
      show(`Loaded ${j.items.length} records.`);
      const tb=document.querySelector('#tbl tbody'); tb.innerHTML='';
      j.items.forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${new Date(r.createdAt).toLocaleString()}</td><td>${r.email}</td><td>${r.postcode}</td><td>${r.radius}</td>`;
        tb.appendChild(tr);
      });
    }catch{show('Network error',false);}
  });
  document.getElementById('btnTest')?.addEventListener('click',async()=>{
    show('Sending…');
    const password=document.getElementById('apw').value||'';
    const to=document.getElementById('testTo').value||'';
    try{
      const res=await fetch('/api/admin/test-email',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password,to})});
      const j=await res.json().catch(()=>null);
      if(!res.ok||!j?.ok){show(j?.error||'Failed',false);return;}
      show('Test email sent.');
    }catch{show('Network error',false);}
  });
</script>
</body>
</html>
